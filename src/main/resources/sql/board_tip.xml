<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="board_tip">
	<sql id="includeBoard">
		WHERE isdeleted=0
		<if test="searchKeyword!=null and searchKeyword!=''">
		AND
			<foreach item="item" index="index" open="(" close=")" separator="or" collection="searchTypeArr">
				${item} LIKE CONCAT('%', #{searchKeyword},'%' )
			</foreach>
		</if>
	</sql>

	<select id="selectBoardList" resultType="devsepark.board.model.BoardTip" parameterType="devsepark.board.common.SearchVo">
		SELECT id, title, writer, date_format(date,'%Y-%m-%d') date, hit
		FROM board_tip
		<include refid="includeBoard"/>
		ORDER BY id DESC
		LIMIT ${rowStart - 1}, 10
	</select>
	
	<select id="selectBoardCount" resultType="Integer" parameterType="devsepark.board.common.SearchVo">
		SELECT COUNT(*)
		FROM board_tip
		<include refid="includeBoard"/>
	</select>

	<insert id="insertBoard" parameterType="devsepark.board.model.BoardTip">
		INSERT INTO board_tip(title, writer, content, date, hit, isdeleted)
		VALUES (#{title}, #{writer}, #{content}, NOW(), 0, 0 )
	</insert>

	<update id="updateBoard" parameterType="devsepark.board.model.BoardTip">
		UPDATE board_tip
		SET title=#{title}
		, writer=#{writer}
		, content=#{content}
		WHERE id=#{id}
		AND isdeleted=0
	</update>

	<update id="updateBoardHit" parameterType="String">
		UPDATE board_tip
		SET hit = hit +1
		WHERE id =#{id}
	</update>

	<select id="selectBoardOne" parameterType="String"
		resultType="devsepark.board.model.BoardTip">
		SELECT id, title, writer, content, DATE_FORMAT(date,'%Y-%m-%d') date
		FROM board_tip
		WHERE id=#{id}
		AND isdeleted=0
	</select>

	<delete id="deleteBoardOne" parameterType="String">
		UPDATE board_tip
		SET isdeleted=1
		WHERE id=#{id}
	</delete>

</mapper>

